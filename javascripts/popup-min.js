(function(){var a=/\{([^\}]+)\}/g,b=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,c=function(a,c,d){var e=d;return c.replace(b,function(a,b,c,d,f){b=b||d,e&&(b in e&&(e=e[b]),typeof e=="function"&&f&&(e=e()))}),e=(e==null||e==d?a:e)+"",e},d=function(b,d){return String(b).replace(a,function(a,b){return c(a,b,d)})};Raphael.fn.popup=function(a,b,c,e,f){e=String(e||"top-middle").split("-"),e[1]=e[1]||"middle";var g=5,h=c.getBBox(),i=Math.round(h.width+20),j=Math.round(h.height+10),k=Math.round(h.x-5)-g,l=Math.round(h.y-5)-g,m=Math.min(j/2,i/2,10),n={top:"M{x},{y}h{w4},{w4},{w4},{w4}a{r},{r},0,0,1,{r},{r}v{h4},{h4},{h4},{h4}a{r},{r},0,0,1,-{r},{r}l-{right},0-{gap},{gap}-{gap}-{gap}-{left},0a{r},{r},0,0,1-{r}-{r}v-{h4}-{h4}-{h4}-{h4}a{r},{r},0,0,1,{r}-{r}z",bottom:"M{x},{y}l{left},0,{gap}-{gap},{gap},{gap},{right},0a{r},{r},0,0,1,{r},{r}v{h4},{h4},{h4},{h4}a{r},{r},0,0,1,-{r},{r}h-{w4}-{w4}-{w4}-{w4}a{r},{r},0,0,1-{r}-{r}v-{h4}-{h4}-{h4}-{h4}a{r},{r},0,0,1,{r}-{r}z",right:"M{x},{y}h{w4},{w4},{w4},{w4}a{r},{r},0,0,1,{r},{r}v{h4},{h4},{h4},{h4}a{r},{r},0,0,1,-{r},{r}h-{w4}-{w4}-{w4}-{w4}a{r},{r},0,0,1-{r}-{r}l0-{bottom}-{gap}-{gap},{gap}-{gap},0-{top}a{r},{r},0,0,1,{r}-{r}z",left:"M{x},{y}h{w4},{w4},{w4},{w4}a{r},{r},0,0,1,{r},{r}l0,{top},{gap},{gap}-{gap},{gap},0,{bottom}a{r},{r},0,0,1,-{r},{r}h-{w4}-{w4}-{w4}-{w4}a{r},{r},0,0,1-{r}-{r}v-{h4}-{h4}-{h4}-{h4}a{r},{r},0,0,1,{r}-{r}z"},o={hx0:a-(k+g+i-m*2),hx1:a-(k+g+i/2-m),hx2:a-(k+g+m),vhy:b-(l+g+j+g+m),"^hy":b-(l-m)},p=[{x:k+g,y:l,w:i,w4:i/4,h4:j/4,right:0,left:i-m*2,bottom:0,top:j-m*2,r:g,h:j,gap:m},{x:k+g,y:l,w:i,w4:i/4,h4:j/4,left:i/2-m,right:i/2-m,top:j/2-m,bottom:j/2-m,r:g,h:j,gap:m},{x:k+g,y:l,w:i,w4:i/4,h4:j/4,left:0,right:i-m*2,top:0,bottom:j-m*2,r:g,h:j,gap:m}][e[1]=="middle"?1:(e[1]=="top"||e[1]=="left")*2],q=0,r=0,s=this.path(d(n[e[0]],p)).insertBefore(c);switch(e[0]){case"top":q=a-(k+g+p.left+m),r=b-(l+g+j+g+m);break;case"bottom":q=a-(k+g+p.left+m),r=b-(l-m);break;case"left":q=a-(k+g+i+g+m),r=b-(l+g+p.top+m);break;case"right":q=a-(k-m),r=b-(l+g+p.top+m)}return s.translate(q,r),f?(f=s.attr("path"),s.remove(),{path:f,dx:q,dy:r}):(c.translate(q,r),s)}})()
