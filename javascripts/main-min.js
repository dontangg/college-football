var app=$.sammy(function(){this.get("#/:conferenceName",function(){var a=this.params.conferenceName;$("#conference-chooser").val(a);if(a==="All"){$("#map-wrap .description").hide();for(var b=0;b<teams.length;b++)teams[b].dot.show()}else{$("#map-wrap .description li").remove(),$("#map-wrap .description").removeClass("left right").addClass(conferences[a].description);var c=$("#map-wrap .description ul");c.append("<li><h2 style='color:"+conferences[a].color+"'>"+a+"</h2></li>");var d=[];for(var b=0;b<teams.length;b++){var e=teams[b];e.conference===a?(d.push(e),e.dot.show()):e.dot.hide()}d.sort(function(a,b){return a.division+a.school<b.division+b.school?-1:a.division+a.school>b.division+b.school?1:0});var f=null;for(var b=0;b<d.length;b++){var e=d[b];f!==e.division&&(f=e.division,c.append("<li><h3>"+f+"</h3></li>")),function(a){$("<li class='school'>"+a.school+"</li>").appendTo(c).hover(function(){a.popup.show().toFront()},function(){a.popup.hide()})}(e)}$("#map-wrap .description").show()}})});$(function(){var a=Raphael("map",960,620);a.image("usa.png",11,3,938,593);for(var b=0;b<teams.length;b++){var c=teams[b];(function(b){var c="logos/"+(b.school+" "+b.mascot).replace(/ A&M/,"").replace(/ /g,"-").replace(/[()']/g,"").toLowerCase()+".gif",d=a.set();d.push(a.image(c,0,0,80,80));var e=a.text(90,20,b.school+"\n"+b.mascot).attr({"font-family":"Lato","font-size":14}),f=a.text(90,50,b.location),g=a.text(90,70,b.conference),h=Math.max(e.getBBox().width,f.getBBox().width,g.getBBox().width);e.translate(h/2,0),f.translate(h/2,0),g.translate(h/2,0),d.push(e),d.push(f),d.push(g),d.hide();var i=b.x,j=b.y,k=b.popupPosition||"right",l=i;k==="right"?l+=5:l-=5;var m=a.popup(l,j,d,k).attr({fill:"#fff",stroke:"#888","stroke-width":2,"fill-opacity":.8}).hide(),n=a.set();n.push(m),n.push(d),b.popup=n;var o=conferences[b.conference].fillColor,p=conferences[b.conference].color,q=a.circle(i,j,3).attr({fill:o||"#fff","fill-opacity":o?1:0,stroke:p,"stroke-width":1}),s=a.circle(i,j,5).attr({stroke:"none",fill:"#fff","fill-opacity":0,"stoke-opacity":0});s.hover(function(){q.attr("r",5),m.show().toFront(),d.show().toFront()},function(){q.attr("r",3),m.hide(),d.hide()});var t=a.set();t.push(q),t.push(s),b.dot=t})(c)}$("#conference-chooser").change(function(){app.setLocation("#/"+$(this).val())}),$("#search-box").bind("keyup search",function(){var a=$(this).val().toLowerCase();for(var b=0;b<teams.length;b++)(teams[b].school+teams[b].mascot).toLowerCase().indexOf(a)>-1?teams[b].dot.attr({opacity:1}):teams[b].dot.attr({opacity:.2})}),app.run("#/All")})
